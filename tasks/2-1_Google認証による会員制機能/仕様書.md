# Google認証による会員制機能 仕様書

## 1. ユーザーニーズ

### 対象ユーザー
- AIキャリア診断LPの訪問者
- 診断結果を保存・再閲覧したいユーザー

### ニーズ
- 簡単にログインしたい（Google認証でワンクリック）
- ログイン後にマイページ（ダッシュボード）を確認したい
- プロフィール情報を管理したい

## 2. 仕様要件

### 認証方式
- **Google OAuth 2.0**（Auth.js v5 を使用）
- JWT セッション管理
- MongoDB にユーザー情報を永続化

### 画面構成
| 画面 | パス | 認証要否 | 説明 |
|------|------|---------|------|
| ログイン | `/auth/signin` | 不要 | Googleログインボタン |
| ダッシュボード | `/dashboard` | 必要 | ユーザー情報カード、ナビリンク |
| プロフィール | `/profile` | 必要 | 情報表示・名前編集・保存 |

### API エンドポイント
| メソッド | パス | 説明 |
|---------|------|------|
| GET | `/api/user/profile` | ユーザープロフィール取得 |
| PUT | `/api/user/profile` | ユーザープロフィール更新 |

### 認証保護
- `/dashboard` と `/profile` はミドルウェアで保護
- 未認証ユーザーは `/auth/signin` にリダイレクト

## 3. 処理手順設計

### 認証フロー
1. ユーザーが `/auth/signin` にアクセス
2. 「Googleでログイン」ボタンをクリック
3. Google OAuth 認証画面にリダイレクト
4. 認証成功 → Auth.js がセッション作成
5. MongoDB にユーザー情報を保存（初回のみ）
6. `/dashboard` にリダイレクト

### プロフィール更新フロー
1. `/profile` で現在の情報を表示（GET API）
2. ユーザーが名前を編集
3. 「保存」ボタンで PUT API を呼び出し
4. MongoDB のユーザー情報を更新
5. 成功トースト表示

## 4. 技術スタック
- **認証**: Auth.js v5 (next-auth@beta)
- **DB**: MongoDB (mongodb ドライバー + @auth/mongodb-adapter)
- **UI**: MUI v6 (既存テーマを活用)
- **セッション**: JWT ベース

## 5. ファイル構成

### 新規作成ファイル
- `lib/db.ts` - MongoDB クライアント
- `auth.config.ts` - Auth.js 軽量設定
- `auth.ts` - Auth.js メイン設定
- `middleware.ts` - ルート保護
- `app/providers/SessionProvider.tsx` - セッションプロバイダー
- `app/api/auth/[...nextauth]/route.ts` - NextAuth ルートハンドラー
- `app/api/user/profile/route.ts` - プロフィール API
- `app/auth/signin/page.tsx` - ログインページ
- `app/dashboard/page.tsx` - ダッシュボード
- `app/profile/page.tsx` - プロフィールページ

### 変更ファイル
- `.gitignore` - `.env*.local` 追加
- `app/layout.tsx` - SessionProvider 追加
