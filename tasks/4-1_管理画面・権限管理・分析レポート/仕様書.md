# 管理者ダッシュボード・権限管理・分析レポート 仕様書

## 1. ユーザーニーズ
- 管理者が診断データの全体傾向を把握したい
- ユーザーの管理（ロール変更、一覧閲覧）を行いたい
- エラーの発生状況を監視したい
- 診断データをCSVでエクスポートして外部分析に使いたい

## 2. 仕様要件

### 2.1 ロール管理
- ユーザーロール: `user`（デフォルト）、`admin`
- MongoDB usersコレクションの`role`フィールドで管理
- JWTトークンにroleを含め、セッションで参照可能にする
- `/admin`配下はadminロールのみアクセス可能

### 2.2 管理画面ダッシュボード (`/admin`)
- 統計カード: 本日の診断数 / 総診断数 / アクティブユーザー数
- 最近の診断5件テーブル
- システムステータス（DB接続状態）
- クイックアクションボタン

### 2.3 ユーザー管理 (`/admin/users`)
- DataGrid一覧: 名前、メール、ロール、最終ログイン、診断数
- 検索（メール・名前）+ ロールフィルタ
- ロール変更（admin⇔user）+ 確認ダイアログ
- ユーザー詳細: プロフィール + 診断履歴

### 2.4 分析レポート (`/admin/analytics`)
- 診断数の日別/週別/月別推移（LineChart）
- 人気キャリアパスTOP10（BarChart）
- 診断完了率（PieChart）
- CSVエクスポート機能

### 2.5 エラーログ監視 (`/admin/errors`)
- Sentry連携（プレースホルダー）
- SENTRY_DSN設定で本番稼働可能な構成
- エラーログ一覧画面

## 3. 技術仕様
- Next.js 16 (App Router) / MUI v6 / NextAuth v5 beta (JWT) / MongoDB native driver
- recharts: グラフ描画
- @mui/x-data-grid: ユーザー一覧テーブル
- @sentry/nextjs: エラー監視

## 4. セキュリティ
- 全管理APIでadminロール認証を必須とする
- ミドルウェアレベルで/admin配下のアクセス制御
- API側でも二重チェック（lib/admin-auth.ts）
